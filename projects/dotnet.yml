---
runner: command
params:
  dir: dotnet-example
  setup: dotnet build

  tests:
    - name: normal
      cmd: dotnet run '{{.MONGODB_URI}}'
    - name: strict
      cmd: dotnet run '{{.MONGODB_URI}}' --strict
    - name: noauth
      cmd: dotnet run '{{.MONGODB_URI_ANONYMOUS}}'
    - name: plain
      cmd: dotnet run '{{.MONGODB_URI_PLAIN}}'
    - name: sha1
      cmd: dotnet run '{{.MONGODB_URI_SHA1}}'
    - name: sha256
      cmd: dotnet run '{{.MONGODB_URI_SHA256}}'

results:
  mongodb:
    stats:
      fail: 3
      pass: 3
    fail:
      - plain # Received authentication for mechanism PLAIN which is not enabled
      - sha1 # Authentication failed
      - sha256 # Authentication failed

  mongodb-secured:
    stats:
      fail: 2
      pass: 4
    fail:
      - noauth # Command dropDatabase requires authentication
      - plain # Received authentication for mechanism PLAIN which is not enabled

  ferretdb-postgresql:
    stats:
      fail: 3
      pass: 3
    fail:
      # Unsupported OP_QUERY command: saslStart. The client driver may require an upgrade.
      # TODO https://github.com/FerretDB/FerretDB/issues/4065
      # TODO https://github.com/FerretDB/dance/issues/889
      - plain
      - sha1
      - sha256

  ferretdb-sqlite-replset:
    stats:
      fail: 3
      pass: 3
    fail:
      # Unsupported OP_QUERY command: saslStart. The client driver may require an upgrade.
      # TODO https://github.com/FerretDB/FerretDB/issues/4065
      # TODO https://github.com/FerretDB/dance/issues/889
      - plain
      - sha1
      - sha256

  ferretdb-postgresql-secured:
    stats:
      fail: 5
      pass: 1
    fail:
      - noauth # Authentication failed

      # TODO https://github.com/FerretDB/FerretDB/issues/4065
      # TODO https://github.com/FerretDB/dance/issues/889
      # Unsupported OP_QUERY command: saslStart. The client driver may require an upgrade.
      - plain

      # TODO https://github.com/FerretDB/FerretDB/issues/4065
      # TODO https://github.com/FerretDB/dance/issues/889
      # Unsupported OP_QUERY command: saslContinue. The client driver may require an upgrade.
      - normal
      - sha1
      - sha256

  ferretdb-sqlite-replset-secured:
    stats:
      fail: 5
      pass: 1
    fail:
      - noauth # Authentication failed

      # TODO https://github.com/FerretDB/FerretDB/issues/4065
      # TODO https://github.com/FerretDB/dance/issues/889
      # Unsupported OP_QUERY command: saslStart. The client driver may require an upgrade.
      - plain

      # TODO https://github.com/FerretDB/FerretDB/issues/4065
      # TODO https://github.com/FerretDB/dance/issues/889
      # Unsupported OP_QUERY command: saslContinue. The client driver may require an upgrade.
      - normal
      - sha1
      - sha256
