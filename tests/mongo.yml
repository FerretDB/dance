---
runner: jstest

# To exclude a file, use the ! prefix and enclose the file name in quotes.
# Put the exclusion patterns before inclusion patterns.
args:
  # https://github.com/mattn/go-zglob/issues/44 - zglob does not support range wildcards
  - mongo/jstests/core/administrative/auth*.js
  - mongo/jstests/core/query/all/all*.js
  - mongo/jstests/core/query/basic*.js
  - mongo/jstests/core/query/cursor/cursor*.js
  - mongo/jstests/core/query/cursor/getmore*.js
  - mongo/jstests/core/query/awaitdata_getmore_cmd.js
  - mongo/jstests/readonly/get_more.js
  - mongo/jstests/auth/getMore.js
  - mongo/jstests/auth/list_sessions.js
  - mongo/jstests/core/uniqueness.js
  - mongo/jstests/core/query/unset/unset*.js
  - mongo/jstests/core/query/array/array*.js
  - mongo/jstests/core/query/array/arrayfind*.js
  - mongo/jstests/core/query/distinct/distinct_array1.js
  - mongo/jstests/core/query/distinct/distinct*.js
  - mongo/jstests/core/query/elemmatch/elemmatch*.js
  - mongo/jstests/core/write/find_and_modify/find_and_modify.js
  - mongo/jstests/core/write/find_and_modify/find_and_modify*.js
  - mongo/jstests/core/write/update/update*.js
  - mongo/jstests/core/write/update/update*.js

results:
  ferretdb:
    ignore:
    - mongo/jstests/core/query/array/array_comparison_correctness.js
    - mongo/jstests/core/query/array/array_index_and_nonIndex_consistent.js

    stats:
      unexpected_fail: 50
      expected_fail: 42
      expected_pass: 54
    fail:
      # https://docs.ferretdb.io/diff/
      # 3. FerretDB does not support nested arrays.
      - mongo/jstests/core/query/all/all2.js
      - mongo/jstests/core/query/all/all4.js
      - mongo/jstests/core/query/all/all5.js
      - mongo/jstests/core/query/array/array1.js
      - mongo/jstests/core/query/array/arrayfind1.js
      - mongo/jstests/core/query/array/arrayfind2.js
      - mongo/jstests/core/query/array/arrayfind4.js
      - mongo/jstests/core/query/array/arrayfind10.js

      # TODO: create issues / investigate
      - mongo/jstests/core/query/array/array_match2.js
      - mongo/jstests/core/query/array/arrayfinda.js
      - mongo/jstests/core/query/array/arrayfindb.js
      - mongo/jstests/core/query/distinct/distinct_compound_index.js
      - mongo/jstests/core/query/distinct/distinct_index1.js
      - mongo/jstests/core/query/distinct/distinct_index2.js
      - mongo/jstests/core/query/distinct/distinct_multikey.js
      - mongo/jstests/core/query/distinct/distinct_with_hashed_index.js
      - mongo/jstests/core/write/find_and_modify/find_and_modify_concurrent_update.js
      - mongo/jstests/core/write/find_and_modify/find_and_modify_empty_coll.js
      - mongo/jstests/core/write/find_and_modify/find_and_modify_hint.js
      - mongo/jstests/core/write/find_and_modify/find_and_modify_invalid_query_params.js
      - mongo/jstests/core/write/find_and_modify/find_and_modify_metrics.js
      - mongo/jstests/core/write/find_and_modify/find_and_modify_pipeline_update.js
      - mongo/jstests/core/write/find_and_modify/find_and_modify_server6865.js
      - mongo/jstests/core/write/find_and_modify/find_and_modify_server6993.js
      - mongo/jstests/core/write/find_and_modify/find_and_modify_server7660.js
      - mongo/jstests/core/write/find_and_modify/find_and_modify_where.js
      - mongo/jstests/core/write/update/update_addToSet.js
      - mongo/jstests/core/write/update/update_affects_indexes.js
      - mongo/jstests/core/write/update/update_arrayFilters.js
      - mongo/jstests/core/write/update/update_array_offset_positional.js
      - mongo/jstests/core/write/update/update_arraymatch1.js
      - mongo/jstests/core/write/update/update_arraymatch2.js
      - mongo/jstests/core/write/update/update_arraymatch3.js
      - mongo/jstests/core/write/update/update_arraymatch4.js
      - mongo/jstests/core/write/update/update_arraymatch5.js
      - mongo/jstests/core/write/update/update_arraymatch6.js
      - mongo/jstests/core/write/update/update_arraymatch7.js
      - mongo/jstests/core/write/update/update_arraymatch8.js
      - mongo/jstests/core/write/update/update_bit_examples.js
      - mongo/jstests/core/write/update/update_dbref.js
      - mongo/jstests/core/write/update/update_find_and_modify_id.js
      - mongo/jstests/core/write/update/update_hint.js
      - mongo/jstests/core/write/update/update_invalid1.js
      - mongo/jstests/core/write/update/update_metrics.js
      - mongo/jstests/core/write/update/update_min_max_examples.js
      - mongo/jstests/core/write/update/update_modifier_pop.js
      - mongo/jstests/core/write/update/update_numeric_field_name.js
      - mongo/jstests/core/write/update/update_pipeline_shell_helpers.js
      - mongo/jstests/core/write/update/update_server-12848.js
      - mongo/jstests/core/write/update/update_setOnInsert.js
      - mongo/jstests/core/write/update/update_with_large_hint.js
      - mongo/jstests/core/write/update/update_with_pipeline.js
      - mongo/jstests/core/write/update/updatea.js
      - mongo/jstests/core/write/update/updated.js
      - mongo/jstests/core/write/update/updatek.js



      # https://github.com/FerretDB/FerretDB/issues/2262
      - mongo/jstests/core/query/array/arrayfind5.js

      # https://github.com/FerretDB/FerretDB/issues/1710
      # https://github.com/FerretDB/FerretDB/issues/731
      - mongo/jstests/core/query/array/arrayfind3.js
      - mongo/jstests/core/query/array/arrayfind6.js
      - mongo/jstests/core/query/array/arrayfind7.js
      - mongo/jstests/core/query/array/arrayfind8.js
      - mongo/jstests/core/query/array/arrayfind9.js

      # https://github.com/FerretDB/FerretDB/issues/1492
      - mongo/jstests/core/administrative/auth1.js

      # https://github.com/FerretDB/FerretDB/issues/1750
      # logout deprecated since version 5.0.
      - mongo/jstests/core/administrative/auth2.js

      # https://github.com/FerretDB/FerretDB/issues/161
      - mongo/jstests/core/query/basic1.js

      # \x0D JavaScript code BSON type not implemented
      - mongo/jstests/core/query/cursor/cursora.js

      # https://github.com/FerretDB/FerretDB/issues/2286
      - mongo/jstests/core/query/cursor/getmore_invalidated_cursors.js

      # https://github.com/FerretDB/FerretDB/issues/2283
      # https://github.com/FerretDB/FerretDB/issues/2284
      - mongo/jstests/core/query/awaitdata_getmore_cmd.js

      # TODO: create issue BSON field 'batchSize' is the wrong type 'double', expected type 'int'
      - mongo/jstests/core/query/cursor/getmore_invalidated_documents.js
      - mongo/jstests/core/query/cursor/getmore_cmd_maxtimems.js

      # https://github.com/FerretDB/FerretDB/issues/730
      - mongo/jstests/core/query/elemmatch/elemmatch_or_pushdown.js

      # https://github.com/FerretDB/FerretDB/issues/1710
      - mongo/jstests/core/query/elemmatch/elemmatch_projection.js

      # https://github.com/FerretDB/dance/issues/295
      - mongo/jstests/core/query/elemmatch/elemmatch_object.js
      - mongo/jstests/core/query/elemmatch/elemmatch_value.js

      # https://github.com/FerretDB/FerretDB/issues/1745
      - mongo/jstests/core/write/find_and_modify/find_and_modify.js
      - mongo/jstests/core/write/find_and_modify/find_and_modify2.js
      - mongo/jstests/core/write/find_and_modify/find_and_modify3.js
      - mongo/jstests/core/write/find_and_modify/find_and_modify4.js

      # https://jira.mongodb.org/browse/SERVER-14832
      - mongo/jstests/core/query/distinct/distinct_array1.js

      # https://github.com/FerretDB/FerretDB/issues/2236
      - mongo/jstests/core/query/distinct/distinct1.js
      - mongo/jstests/core/query/distinct/distinct_multikey_dotted_path.js

      # https://github.com/FerretDB/FerretDB/issues/2231
      - mongo/jstests/core/query/distinct/distinct4.js

      # https://github.com/FerretDB/FerretDB/issues/1384
      - mongo/jstests/core/uniqueness.js

      # https://github.com/FerretDB/FerretDB/issues/1242
      - mongo/jstests/core/query/unset/unset2.js

      # https://github.com/FerretDB/FerretDB/issues/1855
      - mongo/jstests/core/write/update/update8.js
      - mongo/jstests/core/write/update/updatej.js

      # https://github.com/FerretDB/FerretDB/issues/1742
      - mongo/jstests/core/write/update/updateb.js
      - mongo/jstests/core/write/update/updatel.js

      # https://docs.ferretdb.io/diff/
      # 5. Document restrictions:
      # document keys must not contain $ or . signs;
      - mongo/jstests/core/write/update/updateh.js

      # https://github.com/FerretDB/dance/issues/294
      - mongo/jstests/readonly/get_more.js
      - mongo/jstests/auth/getMore.js
      - mongo/jstests/auth/list_sessions.js
  mongodb:
    stats:
      expected_fail: 3
      expected_pass: 143
    fail:
    # https://github.com/FerretDB/dance/issues/294
    - mongo/jstests/auth/getMore.js
    - mongo/jstests/readonly/get_more.js
    - mongo/jstests/auth/list_sessions.js
